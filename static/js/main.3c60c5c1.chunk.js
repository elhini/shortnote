(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{116:function(e,t,n){e.exports=n(150)},121:function(e,t,n){},122:function(e,t,n){},137:function(e,t,n){},138:function(e,t,n){},141:function(e,t,n){},142:function(e,t,n){},143:function(e,t,n){},144:function(e,t,n){},145:function(e,t,n){},147:function(e,t,n){},148:function(e,t,n){},149:function(e,t,n){},150:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(30),o=n.n(r),s=(n(121),n(9)),l=n(10),c=n(14),u=n(13),m=n(15),d=n(65),h=n(51),p=n(44),g=n(45),f=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,null,[{key:"sendJSON",value:function(e,t,n,a){var i=n?JSON.stringify(n):null;fetch(e,{method:t,headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",body:i}).then(function(e){var t="status: "+e.status+", statusText: "+e.statusText+", url: "+e.url;return 200===e.status?e.json():{error:t}}).then(function(e){return a(e)}).catch(function(e){return console.error("Error:",e)})}}]),e}(),b={apiHost:"https://shortnote.herokuapp.com"},v=function(){function e(t,n){Object(s.a)(this,e),this.collection=t,this.component=n,this.url=void 0;var a="shortnote"===window.location.hostname.split(".")[0]?b.apiHost:"";this.url=a+"/api/"+t}return Object(l.a)(e,[{key:"getWaitingStateField",value:function(e){return"GET"===e?"loading":"submitting"}},{key:"handleReq",value:function(e,t,n,a){var i=this;if(this.component){var r=this.getWaitingStateField(e);this.component.setState(Object(g.a)({error:""},r,!0))}f.sendJSON(this.url+t,e,n,function(t){i.handleRes(a,t,e)})}},{key:"handleRes",value:function(e,t,n){if(this.component){var a=this.getWaitingStateField(n);this.component.setState(Object(g.a)({error:t.error||""},a,!1))}else t.error&&alert(JSON.stringify(t.error));t.error||e(t)}},{key:"create",value:function(e,t){this.handleReq("POST","",e,t)}},{key:"getAll",value:function(e){this.handleReq("GET","",null,e)}},{key:"get",value:function(e,t){this.handleReq("GET","/"+e,null,t)}},{key:"update",value:function(e,t){this.handleReq("PUT","/"+e._id,e,t)}},{key:"remove",value:function(e,t){this.handleReq("DELETE","/"+e._id,null,t)}}]),e}(),E=function(e){function t(e){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,"users",e))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"register",value:function(e,t,n){var a={login:e,password:t};this.handleReq("POST","/register",a,n)}},{key:"login",value:function(e,t,n){var a={login:e,password:t};this.handleReq("POST","/login",a,n)}},{key:"logout",value:function(e){this.handleReq("POST","/logout",null,e)}}]),t}(v),y=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,null,[{key:"set",value:function(e,t){localStorage.setItem(e,t)}},{key:"get",value:function(e){return localStorage.getItem(e)}}]),e}(),O=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,null,[{key:"isLoggedIn",value:function(){var e=this.getSession();return e&&e.expireDate>(new Date).toISOString()}},{key:"getSession",value:function(){return this.session||JSON.parse(y.get("session"))}},{key:"setSession",value:function(e){y.set("session",JSON.stringify(e)),this.session=e}},{key:"isAdmin",value:function(){var e=this.getSession();return this.isLoggedIn()&&e.isAdmin}}]),e}(),k=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.a.createElement("h2",null,"Lite and simple app")}}]),t}(i.a.Component),C=n(19),j=(n(122),n(171)),S=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={redirectToReferrer:!1,login:"",password:"",submitting:!1,error:""},n.register=function(e){return e.preventDefault(),n.state.login?n.state.password?void new E(Object(C.a)(n)).register(n.state.login,n.state.password,function(e){e.loggedAs=n.state.login,O.setSession(e),n.setState({redirectToReferrer:!0})}):n.setState({error:"password is empty"}):n.setState({error:"login is empty"})},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"onInputChange",value:function(e,t){this.setState(Object(g.a)({},e,t.target.value))}},{key:"render",value:function(){var e=this,t=(this.props.location.state||{from:{pathname:"/notes"}}).from;return this.state.redirectToReferrer?i.a.createElement(h.a,{to:t}):i.a.createElement("form",{id:"registerForm"},i.a.createElement("h2",null,"Register a new account"),i.a.createElement("div",{className:"fieldBlock"},i.a.createElement("label",null,"Login:"),i.a.createElement("input",{type:"text",name:"login",value:this.state.login,onChange:function(t){return e.onInputChange("login",t)}})),i.a.createElement("div",{className:"fieldBlock"},i.a.createElement("label",null,"Password:"),i.a.createElement("input",{type:"password",name:"password",value:this.state.password,onChange:function(t){return e.onInputChange("password",t)}})),i.a.createElement(j.a,{variant:"outlined",type:"submit",id:"submitRegisterForm",onClick:function(t){return e.register(t)},disabled:this.state.submitting},this.state.submitting?"Registering...":"Register"),i.a.createElement("br",null),this.state.error&&i.a.createElement("div",{className:"alert error",id:"registerError"},this.state.error))}}]),t}(i.a.Component),I=(n(137),function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={redirectToReferrer:!1,login:"",password:"",submitting:!1,error:""},n.login=function(e){return e.preventDefault(),n.state.login?n.state.password?void new E(Object(C.a)(n)).login(n.state.login,n.state.password,function(e){e.loggedAs=n.state.login,O.setSession(e),n.setState({redirectToReferrer:!0})}):n.setState({error:"password is empty"}):n.setState({error:"login is empty"})},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"onInputChange",value:function(e,t){this.setState(Object(g.a)({},e,t.target.value))}},{key:"render",value:function(){var e=this,t=(this.props.location.state||{from:{pathname:"/notes"}}).from;if(this.state.redirectToReferrer)return i.a.createElement(h.a,{to:t});var n="/login"===this.props.location.pathname;return O.isLoggedIn()?"You are already logged in":i.a.createElement("div",null,n?"":i.a.createElement("p",null,"You must log in to view the page at ",t.pathname),i.a.createElement("form",{id:"loginForm"},i.a.createElement("h2",null,"Log in to an existing account"),i.a.createElement("div",{className:"fieldBlock"},i.a.createElement("label",null,"Login:"),i.a.createElement("input",{type:"text",name:"login",value:this.state.login,onChange:function(t){return e.onInputChange("login",t)}})),i.a.createElement("div",{className:"fieldBlock"},i.a.createElement("label",null,"Password:"),i.a.createElement("input",{type:"password",name:"password",value:this.state.password,onChange:function(t){return e.onInputChange("password",t)}})),i.a.createElement(j.a,{variant:"outlined",type:"submit",id:"submitLoginForm",onClick:function(t){return e.login(t)},disabled:this.state.submitting},this.state.submitting?"Logging in...":"Log in"),i.a.createElement("br",null),this.state.error&&i.a.createElement("div",{className:"alert error",id:"loginError"},this.state.error)))}}]),t}(i.a.Component)),w=n(81),L=function(e){function t(e){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,"notes",e))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"getPublic",value:function(e,t){this.handleReq("GET","/public/"+e,null,t)}}]),t}(v),D=function(e){function t(e){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,"settings",e))}return Object(m.a)(t,e),t}(v),A=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,null,[{key:"isContains",value:function(e,t){return e.toLowerCase().includes(t.toLowerCase())}}]),e}(),N=n(103),P=(n(138),function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.filters;return i.a.createElement("form",{id:"Filters"},i.a.createElement("label",null,"Filter"),":"," ",i.a.createElement("span",{className:"fieldInline"},i.a.createElement("label",null,"by title & text")," ",i.a.createElement("input",{type:"text",id:"textFilter",value:t.text,onChange:function(t){return e.props.onFiltersChange({text:t.target.value})},key:"textFilter"})),i.a.createElement("span",{className:"fieldInline"},i.a.createElement("label",null,"by tags")," ",i.a.createElement(N.a,{id:"tagsFilter",value:t.tags,isMulti:!0,options:this.props.tags,onChange:function(t){return e.props.onFiltersChange({tags:t})}})))}}]),t}(i.a.Component)),x=(n(141),function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.sort,n=[{id:"dateOfUpdate",name:"date of update"},{id:"dateOfCreate",name:"date of create"}].map(function(e){return i.a.createElement("option",{key:e.id,value:e.id},e.name)}),a=[{id:"desc",name:"descending"},{id:"asc",name:"ascending"}].map(function(e){return i.a.createElement("option",{key:e.id,value:e.id},e.name)});return i.a.createElement("form",{id:"Sort"},i.a.createElement("label",null,"Sort"),":"," ",i.a.createElement("span",{className:"fieldInline"},i.a.createElement("label",null,"by")," ",i.a.createElement("select",{id:"sortField",value:t.field,onChange:function(t){return e.props.onSortChange({field:t.target.value})}},n)," ",i.a.createElement("label",null,"in")," ",i.a.createElement("select",{id:"sortDirection",value:t.direction,onChange:function(t){return e.props.onSortChange({direction:t.target.value})}},a)," ",i.a.createElement("label",null,"order")))}}]),t}(i.a.Component)),T=n(172),F=n(105),_=n.n(F),B=n(88),R=n.n(B),U=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={value:R.a.createValueFromString(n.props.value,"html")},n.onChange=function(e){n.setState({value:e}),n.props.onChange(e.toString("html"))},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.a.createElement(R.a,{value:this.state.value,onChange:this.onChange})}}]),t}(i.a.Component),M=n(104),q=(n(142),function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).titleInput=void 0,n.publicLinkInput=void 0,n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.titleInput&&this.titleInput.focus()}},{key:"copyPublicLink",value:function(){this.publicLinkInput&&(this.publicLinkInput.focus(),this.publicLinkInput.select());try{document.execCommand("copy"),this.props.onPublicLinkCopy()}catch(e){console.error("unable to copy",e)}}},{key:"render",value:function(){var e=this,t=this.props.item,n=window.location.origin+"/notes/public/"+t._id,a=i.a.createElement(i.a.Fragment,null,i.a.createElement("input",{type:"text",id:"publicLink",value:n,readOnly:!0,ref:function(t){return e.publicLinkInput=t}}),i.a.createElement(T.a,{id:"copyPublicLink",title:"Copy public link",onClick:function(t){return e.copyPublicLink()}},i.a.createElement(_.a,null)));return i.a.createElement("form",{id:"Form",onSubmit:this.props.onSubmit,key:t._id},i.a.createElement("input",{type:"hidden",id:"id",value:t._id,readOnly:!0}),i.a.createElement("div",{className:"fieldBlock",id:"titleAndPublicAccess"},i.a.createElement("input",{type:"text",id:"title",value:t.title,onChange:function(t){return e.props.onItemChange({title:t.target.value})},autoFocus:!0,ref:function(t){return e.titleInput=t}}),i.a.createElement("label",{htmlFor:"publicAccess"},i.a.createElement("input",{type:"checkbox",id:"publicAccess",checked:t.publicAccess,onChange:function(t){return e.props.onItemChange({publicAccess:t.target.checked})}}),"Public access")," ",t.publicAccess&&a),i.a.createElement("div",{className:"fieldBlock"},i.a.createElement(U,{value:t.text,onChange:function(t){return e.props.onItemChange({text:t})}})),i.a.createElement("div",{className:"fieldBlock"},i.a.createElement(M.a,{id:"tags",isMulti:!0,options:this.props.tags,value:t.tags,onChange:function(t){return e.props.onItemChange({tags:t})},onCreateOption:this.props.onCreateTag})),this.props.submitEnabled?i.a.createElement("div",{className:"fieldBlock"},i.a.createElement(j.a,{variant:"outlined",type:"submit",id:"submit",disabled:this.props.sending},this.props.sending?"Sending...":"Submit")):null,i.a.createElement("span",{id:"formState"},this.props.sending?"Saving...":this.props.changed?"Changed":t._id?"Saved":""))}}]),t}(i.a.Component)),J=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,null,[{key:"toStr",value:function(e){return(e instanceof Date?e.toISOString():e||"").replace("T"," ").substr(0,19)}}]),e}(),H=n(76),W=n.n(H),G=(n(143),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).onDelete=n.onDelete.bind(Object(C.a)(n)),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"onDelete",value:function(e,t){e.stopPropagation(),e.preventDefault(),this.props.onDeleteItem(t)}},{key:"strip",value:function(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent||""}},{key:"buildNodes",value:function(){var e=this,t=this.props.items.map(function(t){if(!t._id)return null;var n=e.props.item&&e.props.item._id===t._id?"opened":"",a=(t.tags||[]).map(function(e){return i.a.createElement("span",{className:"tag","data-id":e.value,key:e.value},e.label)}),r=i.a.createElement("div",{className:"aside"},i.a.createElement("div",{className:"aside-inner"},i.a.createElement("span",{className:"dateOfCreate",title:"Date of create"},J.toStr(t.dateOfCreate)),i.a.createElement("span",{className:"dateOfUpdate",title:"Date of update"},J.toStr(t.dateOfUpdate)),i.a.createElement("div",{className:"tags"},a)),i.a.createElement(T.a,{className:"delete",title:"Delete note",onClick:function(n){return window.confirm("Delete this item?")&&e.onDelete(n,t)}},i.a.createElement(W.a,null)));return i.a.createElement("li",{key:t._id,className:n},i.a.createElement(p.b,{to:"/notes/"+t._id},r,i.a.createElement("div",{className:"title"},t.title),i.a.createElement("div",{className:"text"},e.strip(t.text))))});return t.length?t:i.a.createElement("li",null,"No items found")}},{key:"render",value:function(){return i.a.createElement("ul",{id:"List"},this.props.loading?i.a.createElement("li",null,"Loading..."):this.buildNodes())}}]),t}(i.a.Component)),V=n(79),z=n(5),Y=n(106),$=n.n(Y),K=n(108),Q=n.n(K),X=n(109),Z=n.n(X),ee=n(110),te=n.n(ee),ne=n(174),ae=n(175),ie=n(186),re=n(190),oe=n(107),se=n.n(oe),le=n(173),ce={success:$.a,warning:se.a,error:Q.a,info:Z.a},ue=Object(le.a)(function(e){return{success:{backgroundColor:ne.a[600]},error:{backgroundColor:e.palette.error.dark},info:{backgroundColor:e.palette.primary.main},warning:{backgroundColor:ae.a[700]},icon:{fontSize:20},iconVariant:{opacity:.9,marginRight:e.spacing(1)},message:{display:"flex",alignItems:"center"}}});function me(e){var t=ue(),n=e.className,a=e.message,r=e.onClose,o=e.variant,s=Object(d.a)(e,["className","message","onClose","variant"]),l=ce[o];return i.a.createElement(re.a,Object.assign({className:Object(z.a)(t[o],n),"aria-describedby":"client-snackbar",message:i.a.createElement("span",{id:"client-snackbar",className:t.message},i.a.createElement(l,{className:Object(z.a)(t.icon,t.iconVariant)}),a),action:[i.a.createElement(T.a,{key:"close","aria-label":"Close",color:"inherit",onClick:r},i.a.createElement(te.a,{className:t.icon}))]},s))}function de(e){var t=e.variant,n=e.message,a=e.onClose,r=i.a.useState(!0),o=Object(V.a)(r,2),s=o[0],l=o[1];function c(){l(!1),a&&a()}return i.a.createElement(ie.a,{anchorOrigin:{vertical:"top",horizontal:"right"},open:s,autoHideDuration:2e3,onClose:c},i.a.createElement(me,{onClose:c,variant:t,message:n}))}n(144);var he=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.item;return i.a.createElement("div",{id:"ReadonlyNote"},i.a.createElement("h2",{className:"title"},e.title),i.a.createElement("div",{className:"text",dangerouslySetInnerHTML:{__html:e.text}}))}}]),t}(i.a.Component),pe=n(111),ge=n.n(pe),fe=(n(145),function(e){function t(e){var n;Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).tags=void 0,n.accessLevels=void 0,n.history=void 0,n.stopListeningHistory=void 0,n.notesApiClient=void 0,n.autosaveTimeoutID=void 0;var a="new"===e.match.params.id?n.buildEmptyItem():null;return n.state={item:a,items:[],filters:{text:"",tags:[]},sort:{field:"dateOfUpdate",direction:"desc"},loading:!1,formChanged:!1,submitting:!1,error:"",publicLinkCopied:!1,formManualSubmitEnabled:!1},n.tags=[],n.accessLevels=[{id:1,name:"viewing"},{id:2,name:"editing"}],n.history=e.history,n.stopListeningHistory=n.history.listen(function(e){n.getItemByLocation(n.state.items)}),n.notesApiClient=new L(Object(C.a)(n)),n.autosaveTimeoutID=0,n.onOpenNew=n.onOpenNew.bind(Object(C.a)(n)),n.onSubmit=n.onSubmit.bind(Object(C.a)(n)),n.onDeleteItem=n.onDeleteItem.bind(Object(C.a)(n)),n.onFiltersChange=n.onFiltersChange.bind(Object(C.a)(n)),n.onSortChange=n.onSortChange.bind(Object(C.a)(n)),n.onCreateTag=n.onCreateTag.bind(Object(C.a)(n)),n.onItemChange=n.onItemChange.bind(Object(C.a)(n)),n.onItemChangePartially=n.onItemChangePartially.bind(Object(C.a)(n)),n.onPublicLinkCopy=n.onPublicLinkCopy.bind(Object(C.a)(n)),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"getItemIDFromLocation",value:function(){return window.location.pathname.split("notes/")[1]}},{key:"getPublicItemIDFromLocation",value:function(){return(this.getItemIDFromLocation()||"").split("public/")[1]}},{key:"isPublicItemLocation",value:function(){return!!this.getPublicItemIDFromLocation()}},{key:"getItemByLocation",value:function(e){var t=this,n=function(n){return t.setState({items:e,item:n})},a=this.getItemIDFromLocation(),i="new"===a?this.buildEmptyItem():e.find(function(e){return e._id===a});if(a&&"new"!==a&&!i){var r=this.getPublicItemIDFromLocation();r?this.notesApiClient.getPublic(r,function(e){n(e)}):this.setState({error:"note with specified id not found"})}n(i)}},{key:"loadSettings",value:function(){var e=this;return new Promise(function(t,n){(new D).getAll(function(n){var a=n[0]||{};e.setState({formManualSubmitEnabled:a.notesFormManualSubmitEnabled}),t()})})}},{key:"loadItems",value:function(){var e=this;return new Promise(function(t,n){e.notesApiClient.getAll(function(n){e.getItemByLocation(n),t()})})}},{key:"componentDidMount",value:function(){this.isPublicItemLocation()?this.getItemByLocation([]):Promise.all([this.loadSettings(),this.loadItems()])}},{key:"componentWillUnmount",value:function(){this.stopListeningHistory()}},{key:"buildEmptyItem",value:function(){return{_id:"",title:"",text:"",tags:[],dateOfCreate:new Date,dateOfUpdate:new Date,publicAccess:!1}}},{key:"onOpenNew",value:function(){var e=this.buildEmptyItem();this.setState({item:e})}},{key:"onSubmit",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state.item;e&&e.preventDefault(),n&&(n.title||n.text)&&(n._id||(n.dateOfCreate=new Date),n.dateOfUpdate=new Date,n._id?this.updateItem(n,function(e){return t.onItemChange(e,!1)}):this.createItem(n,function(e){return t.onItemChange(e,!0)}))}},{key:"createItem",value:function(e,t){this.notesApiClient.create(e,t)}},{key:"updateItem",value:function(e,t){this.notesApiClient.update(e,t)}},{key:"isObjectsEqual",value:function(e,t){return JSON.stringify(e)===JSON.stringify(t)}},{key:"isItemsDiffer",value:function(e,t){return!t||(e.title!==t.title||e.text!==t.text||e.publicAccess!==t.publicAccess||!this.isObjectsEqual(e.tags,t.tags))}},{key:"onItemChange",value:function(e,t){var n=this;e=Object(w.a)({},this.state.item,e);var a=this.isItemsDiffer(e,this.state.item),i=this.state.items;t||(i=i.filter(function(t){return t._id!==e._id})),i.push(e),this.setState({items:i,item:e,formChanged:a}),t&&this.history.push("/notes/"+e._id),!a||this.state.submitting||this.state.formManualSubmitEnabled||(window.clearTimeout(this.autosaveTimeoutID),this.autosaveTimeoutID=window.setTimeout(function(){n.onSubmit(null,e)},1e3))}},{key:"onDeleteItem",value:function(e){var t=this,n=this.state.items;n=n.filter(function(t){return t._id!==e._id}),this.notesApiClient.remove(e,function(){var a=t.state.item&&t.state.item._id===e._id?null:t.state.item;t.setState({items:n,item:a}),t.history.push("/notes")})}},{key:"onFiltersChange",value:function(e){var t=Object(w.a)({},this.state.filters,e);this.setState({filters:t})}},{key:"onSortChange",value:function(e){var t=Object(w.a)({},this.state.sort,e);this.setState({sort:t})}},{key:"filter",value:function(e){var t=this;return e.filter(function(e){var n=t.state.filters.text,a=!!n,i=!a||(A.isContains(e.text,n)||A.isContains(e.title,n)),r=t.state.filters.tags,o=r?r.map(function(e){return e.value}):[],s=e.tags?e.tags.map(function(e){return e.value}):[],l=r&&!!r.length,c=!l||s.some(function(e){return o.includes(e)});return!(a||l)||!e._id||(!a||i)&&(!l||c)})}},{key:"sort",value:function(e){var t=this.state.sort.field,n="asc"===this.state.sort.direction?1:-1;return e.sort(function(e,a){var i=e[t],r=a[t];return t.includes("date")&&(i=J.toStr(i),r=J.toStr(r)),i>r?n:i<r?-n:0})}},{key:"buildTagList",value:function(){return this.state.items.reduce(function(e,t){return e.concat(t.tags||[])},[])}},{key:"onCreateTag",value:function(e){var t=Math.max.apply(Math,this.tags.map(function(e){return e.value})),n={value:t<0?1:t+1,label:e};this.tags.push(n);var a={};a.tags=this.state.item?this.state.item.tags.slice():[],a.tags.push(n),this.onItemChangePartially(a)}},{key:"onItemChangePartially",value:function(e){this.onItemChange(e)}},{key:"onPublicLinkCopy",value:function(){this.setState({publicLinkCopied:!0})}},{key:"render",value:function(){var e=this;return this.state.item&&this.isPublicItemLocation()?i.a.createElement(he,{item:this.state.item}):i.a.createElement("div",{id:"Notes"},i.a.createElement("div",null,i.a.createElement(p.b,{to:"/notes/new",id:"openNew",onClick:this.onOpenNew},i.a.createElement(ge.a,null)," Open new"),this.state.error&&i.a.createElement("div",{className:"alert error",id:"notesError"},this.state.error),this.state.publicLinkCopied&&i.a.createElement(de,{variant:"success",message:"Copied!",onClose:function(){return e.setState({publicLinkCopied:!1})}})),this.renderBody())}},{key:"filterAndSortItems",value:function(e){var t=this.filter(e);return this.sort(t)}},{key:"renderBody",value:function(){var e=this.filterAndSortItems(this.state.items);this.tags=this.buildTagList();var t=null,n=this.state.item;return n&&(t=i.a.createElement(q,{item:n,onSubmit:this.onSubmit,submitEnabled:this.state.formManualSubmitEnabled,tags:this.tags,onCreateTag:this.onCreateTag,onItemChange:this.onItemChangePartially,onPublicLinkCopy:this.onPublicLinkCopy,sending:this.state.submitting,changed:this.state.formChanged})),i.a.createElement("div",{id:"wrap"},i.a.createElement("div",{id:"aside"},i.a.createElement("div",{id:"filtersAndSortCont"},i.a.createElement("div",{id:"filtersCont"},i.a.createElement(P,{filters:this.state.filters,onFiltersChange:this.onFiltersChange,tags:this.tags})),i.a.createElement("div",{id:"sortCont"},i.a.createElement(x,{sort:this.state.sort,onSortChange:this.onSortChange}))),i.a.createElement("div",{id:"listCont"},i.a.createElement(G,{items:e,item:n,onDeleteItem:this.onDeleteItem,loading:this.state.loading}))),i.a.createElement("div",{id:"formCont"},t))}}]),t}(i.a.Component)),be=n(185),ve=n(184),Ee=n(176),ye=n(177),Oe=n(178),ke=n(179),Ce=n(180),je=n(181),Se=n(91),Ie=n.n(Se),we=n(90),Le=n.n(we),De=function(e){function t(e){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,"sessions",e))}return Object(m.a)(t,e),t}(v),Ae=n(89),Ne=n.n(Ae);n(147);function Pe(e){return new Promise(function(t,n){new De(e).getAll(function(e){return t(e)})})}var xe=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).usersAPIClient=void 0,n.state={users:[],sessionsByUser:{},loading:!1,updatingUserID:null},n.usersAPIClient=new E(Object(C.a)(n)),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e,t=this,n=[(e=this,new Promise(function(t,n){new E(e).getAll(function(e){return t(e)})})),Pe(this)];Promise.all(n).then(function(e){var n=e[0],a=Ne.a.groupBy(e[1],function(e){return e.userID});t.setState({users:n,sessionsByUser:a})})}},{key:"onControlClick",value:function(e,t){var n=this;if(["block","unblock"].includes(t)&&(this.setState({updatingUserID:e._id||""}),e.blocked="block"===t,this.usersAPIClient.update(e,function(e){var t=n.state.users.filter(function(t){return t._id!==e._id});t.push(e),n.setState({updatingUserID:null,users:t})})),"delete"===t){if(!window.confirm("Delete this user?"))return;this.setState({updatingUserID:e._id||""}),this.usersAPIClient.remove(e,function(){var t=n.state.users.filter(function(t){return t._id!==e._id});n.setState({updatingUserID:null,users:t})})}}},{key:"renderActionBtn",value:function(e,t,n,a,r){var o=this;return i.a.createElement(T.a,{onClick:function(n){return o.onControlClick(e,t)},className:"actionBtn",title:n,disabled:a},r)}},{key:"renderActionBtns",value:function(e,t){var n=this.renderActionBtn(e,"block","Block",t,i.a.createElement(Le.a,null)),a=this.renderActionBtn(e,"unblock","Unblock",t,i.a.createElement(Le.a,{color:"error"})),r=this.renderActionBtn(e,"delete","Delete",t,i.a.createElement(W.a,null));return i.a.createElement(i.a.Fragment,null,e.blocked?a:n,r)}},{key:"renderTableRow",value:function(e){var t=this.state.sessionsByUser[e._id||""],n=t.filter(function(e){return e.active&&e.expireDate>(new Date).toISOString()}),a=e._id===this.state.updatingUserID;return i.a.createElement(Ee.a,{key:e._id},i.a.createElement(ye.a,{component:"th",scope:"row"},e.login),i.a.createElement(ye.a,null,J.toStr(e.registrationDate)),i.a.createElement(ye.a,null,t.length),i.a.createElement(ye.a,null,n.length?i.a.createElement(Ie.a,null):null),i.a.createElement(ye.a,null,e.isAdmin?i.a.createElement(Ie.a,null):null),i.a.createElement(ye.a,null,this.renderActionBtns(e,a)))}},{key:"render",value:function(){var e=this,t=Ne.a.sortBy(this.state.users,function(e){return e._id});return this.state.loading?i.a.createElement(Oe.a,null):i.a.createElement(ke.a,{id:"Users"},i.a.createElement(Ce.a,null,i.a.createElement(Ee.a,null,i.a.createElement(ye.a,null,"Login"),i.a.createElement(ye.a,null,"Registration date"),i.a.createElement(ye.a,null,"Sessions count"),i.a.createElement(ye.a,null,"Has active sessions"),i.a.createElement(ye.a,null,"Is admin"),i.a.createElement(ye.a,null,"Actions"))),i.a.createElement(je.a,null,t.map(function(t){return e.renderTableRow(t)})))}}]),t}(i.a.Component),Te=n(189),Fe=n(188),_e=n(182),Be=n(183),Re=n(187),Ue=(n(148),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={setting:{},loading:!1,submitting:!1},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;new D(this).getAll(function(t){var n=t[0]||{};e.setState({setting:n})})}},{key:"handleCheck",value:function(e){var t=this,n=Object.assign(this.state.setting,{notesFormManualSubmitEnabled:e.target.checked});new D(this).update(n,function(e){t.setState({setting:e})})}},{key:"render",value:function(){var e=this;return this.state.loading?i.a.createElement(Oe.a,null):i.a.createElement("div",{id:"Settings"},i.a.createElement(Te.a,{component:"fieldset"},i.a.createElement(Fe.a,{component:"legend"},"Notes"),i.a.createElement(_e.a,null,i.a.createElement(Be.a,{label:"Manual form submit",control:i.a.createElement(Re.a,{onChange:function(t){return e.handleCheck(t)},checked:this.state.setting.notesFormManualSubmitEnabled||!1,disabled:this.state.submitting})}))))}}]),t}(i.a.Component));n(149);function Me(e){var t=e.children;return e.activeTabID===e.tabID?i.a.createElement(i.a.Fragment,null,t):i.a.createElement(i.a.Fragment,null)}function qe(){var e=i.a.useState("Users"),t=Object(V.a)(e,2),n=t[0],a=t[1];if(!O.isAdmin())return"This page needs admin session";var r={Users:i.a.createElement(xe,null),Settings:i.a.createElement(Ue,null)},o=Object.keys(r),s=o.map(function(e){return i.a.createElement(ve.a,{label:e,value:e,key:e})}),l=o.map(function(e){return i.a.createElement(Me,{activeTabID:n,tabID:e,key:e},r[e])});return i.a.createElement("div",{id:"Admin"},i.a.createElement(be.a,{value:n,onChange:function(e,t){a(t)}},s),l)}function Je(e){var t=e.component,n=Object(d.a)(e,["component"]);return i.a.createElement(h.b,Object.assign({},n,{render:function(e){return O.isAdmin()?i.a.createElement(t,e):i.a.createElement(h.a,{to:{pathname:"/",state:{from:e.location}}})}}))}function He(e){var t=e.component,n=Object(d.a)(e,["component"]);return i.a.createElement(h.b,Object.assign({},n,{render:function(e){return O.isLoggedIn()?i.a.createElement(t,e):i.a.createElement(h.a,{to:{pathname:"/login",state:{from:e.location}}})}}))}var We=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={submitting:!1},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"logout",value:function(e){var t=this;e.preventDefault(),new E(this).logout(function(){O.setSession(null),t.props.history.push("/login")})}},{key:"getNavLink",value:function(e){var t=e.private&&!O.isLoggedIn(),n=e.admin&&!O.isAdmin();return t||n?null:i.a.createElement(p.c,{to:e.to,exact:e.exact,onClick:e.onClick,key:e.to},e.label)}},{key:"getAuthState",value:function(){var e=this,t=O.isLoggedIn(),n=i.a.createElement("span",{id:"loggedAsCont",key:"loggedAsCont"},"Logged in as ",i.a.createElement("span",{id:"loggedAs"},t&&O.getSession().loggedAs)),a=this.state.submitting?"Logging out...":"Log out",r=this.getNavLink({label:a,to:"/logout",onClick:function(t){return e.logout(t)}}),o=this.getNavLink({label:"Log in",to:"/login"});return t?[n,r]:o}},{key:"render",value:function(){return i.a.createElement("div",{id:"head"},i.a.createElement("h1",null,"ShortNote"),i.a.createElement("div",{id:"nav"},[{label:"Home",to:"/",exact:!0},{label:"Register",to:"/register"},{label:"Notes",to:"/notes",private:!0},{label:"Admin",to:"/admin",admin:!0}].map(this.getNavLink),this.getAuthState()))}}]),t}(i.a.Component),Ge=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=Object(h.f)(We);return i.a.createElement(p.a,null,i.a.createElement(e,null),i.a.createElement("div",{id:"body"},i.a.createElement(h.b,{path:"/",exact:!0,component:k}),i.a.createElement(h.b,{path:"/register",component:S}),i.a.createElement(h.b,{path:"/login",component:I}),i.a.createElement(h.b,{path:"/notes/public/:id",exact:!0,component:fe}),i.a.createElement(He,{path:["/notes","/notes/:id"],exact:!0,component:fe}),i.a.createElement(Je,{path:["/admin"],exact:!0,component:qe})))}}]),t}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(Ge,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[116,1,2]]]);
//# sourceMappingURL=main.3c60c5c1.chunk.js.map